<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠÙ„Ù… - HaM Ø³ÙŠÙ†Ù…Ø§</title>
    <style>
        body {
            margin: 0;
            font-family: "Arial", sans-serif;
            background-color: #111;
            color: #fff;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
            margin: 20px auto;
        }
        
        iframe,
        video {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .buttons {
            text-align: center;
            margin-top: 15px;
        }
        
        button {
            background-color: #1e90ff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 15px;
        }
        
        button:hover {
            background-color: #0d6efd;
        }
    </style>
</head>

<body>



    <div class="buttons">
        <button onclick="setServer(1)">Ø§Ù„Ø³ÙŠØ±ÙØ± 1</button>
        <button onclick="setServer(2)">Ø§Ù„Ø³ÙŠØ±ÙØ± 2</button>
        <button onclick="setServer(3)">Ø§Ù„Ø³ÙŠØ±ÙØ± 3</button>


    </div>

    <div class="video-container">
        <!-- iframe Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠÙ„Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† -->
        <iframe id="video-frame" src=" https://still-dawn-0125.lansr1234567.workers.dev/z966xd1pq4xx?autoplay=1" allow="autoplay" allowfullscreen></iframe>

        <!-- video Ù…Ø®ÙÙŠ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠÙ„Ù… Ù…Ù† Ø§Ù„ÙƒØ§Ø´ -->
        <video id="offline-video" style="display:none;" controls>
      <source src="https://your-cdn-or-filemoon/video.mp4" type="video/mp4">
    </video>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø© idb -->
    <script src="https://unpkg.com/idb@7/build/iife/index-min.js"></script>

    Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ -->
    <script>
        async function saveOffline() {
            const video = document.getElementById("offline-video");
            const source = video.querySelector("source") || video;
            const videoUrl = source.src;

            const db = await idb.openDB("hamcinema", 1, {
                upgrade(db) {
                    if (!db.objectStoreNames.contains("videos")) {
                        db.createObjectStore("videos");
                    }
                }
            });

            if (await db.get("videos", videoUrl)) {
                alert("âœ… Ø§Ù„ÙÙŠÙ„Ù… Ù…Ø­ÙÙˆØ¸ Ø¨Ø§Ù„ÙØ¹Ù„.");
                return;
            }

            alert("ğŸ“¥ Ø¬Ø§Ø±Ù‰ Ø­ÙØ¸ Ø§Ù„ÙÙŠÙ„Ù…...");

            const response = await fetch(videoUrl);
            const reader = response.body.getReader();
            const chunks = [];

            while (true) {
                const {
                    done,
                    value
                } = await reader.read();
                if (done || !value) break;
                chunks.push(value);
            }

            const blob = new Blob(chunks, {
                type: "video/mp4"
            });
            await db.put("videos", blob, videoUrl);

            let episodes = JSON.parse(localStorage.getItem("offline-episodes") || "[]");
            const title = document.title;
            const thumbnail = "/poster.png";
            const series = "movies";

            if (!episodes.find(e => e.url === videoUrl)) {
                episodes.push({
                    url: videoUrl,
                    title,
                    thumbnail,
                    series,
                    time: 0
                });
                localStorage.setItem("offline-episodes", JSON.stringify(episodes));
            }

            alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙÙŠÙ„Ù… ÙˆÙŠÙ…ÙƒÙ†Ùƒ ØªØ´ØºÙŠÙ„Ù‡ Ø¨Ø¯ÙˆÙ† Ù†Øª.");
        }

        async function playOffline() {
            const video = document.getElementById("offline-video");
            const iframe = document.getElementById("video-frame");
            const videoUrl = video.querySelector("source").src;

            const db = await idb.openDB("hamcinema", 1);
            const blob = await db.get("videos", videoUrl);
            if (!blob) {
                alert("âš ï¸ Ø§Ù„ÙÙŠÙ„Ù… ØºÙŠØ± Ù…Ø­ÙÙˆØ¸ Ø¨Ø¹Ø¯.");
                return;
            }

            iframe.style.display = "none";
            video.style.display = "block";

            const blobUrl = URL.createObjectURL(blob);
            video.src = blobUrl;

            const episodes = JSON.parse(localStorage.getItem("offline-episodes") || "[]");
            const ep = episodes.find(e => e.url === videoUrl);
            if (ep && ep.time) video.currentTime = ep.time;

            video.play();

            // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ù
            video.addEventListener("timeupdate", () => {
                const episodes = JSON.parse(localStorage.getItem("offline-episodes") || "[]");
                const ep = episodes.find(e => e.url === videoUrl);
                if (ep) {
                    ep.time = video.currentTime;
                    localStorage.setItem("offline-episodes", JSON.stringify(episodes));
                }
            });
        }
    </script>
    <script>
        function setServer(serverNumber) {
            const iframe = document.getElementById("video-frame");
            const video = document.getElementById("offline-video");
            const source = video.querySelector("source");

            if (serverNumber === 1) {
                // Ø¹Ø±Ø¶ iframe ÙÙ‚Ø· (Ù…Ø«Ù„Ø§Ù‹ Filemoon)
                iframe.style.display = "block";
                video.style.display = "none";

                // ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø· iframe Ù„Ùˆ Ø­Ø¨ÙŠØª
                iframe.src = "https://still-dawn-0125.lansr1234567.workers.dev/vule57clq9fd?autoplay=1  "; // âœï¸ ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ùˆ Ù…Ø­ØªØ§Ø¬

            }
            if (serverNumber === 2) {
                // Ø¹Ø±Ø¶ iframe ÙÙ‚Ø· (Ù…Ø«Ù„Ø§Ù‹ Filemoon)
                iframe.style.display = "block";
                video.style.display = "none";

                // ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø· iframe Ù„Ùˆ Ø­Ø¨ÙŠØª
                iframe.src = "https://still-dawn-0125.lansr1234567.workers.dev/vule57clq9fd?autoplay=1  "; // âœï¸ ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ùˆ Ù…Ø­ØªØ§Ø¬

            } else if (serverNumber === 3) {
                // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø£Ùˆ Ù…Ù† ok.ru
                iframe.style.display = "none";
                video.style.display = "block";

                // ØªØºÙŠÙŠØ± Ø³ÙˆØ±Ø³ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                source.src = "https://odd-salad-1b30.lansr1234567.workers.dev/file_1.mp4   "; // âœï¸ ØºÙŠÙ‘Ø± Ø¯Ù‡ Ù„Ø±Ø§Ø¨Ø· OK Ø£Ùˆ MP4
                video.load();
            }

        }
    </script>

</body>

</html>